services:
  openclaw:
    image: hashwarlock/openclaw-mas-cvm@sha256:9908a79f8242b7b41bb7a8b7c3593f06b0d97cd972604c850ac867e19878be49
    # For local builds, uncomment below and comment out image:
    # build:
    #   context: ..
    #   dockerfile: phala-deploy/Dockerfile
    container_name: openclaw
    privileged: true
    ports:
      - "1022:22"
      - "18789:18789"
    volumes:
      - /home/root/.ssh:/root/.ssh:ro
      - openclaw_state:/data/openclaw
      - docker_data:/var/lib/docker
      - /var/run/dstack.sock:/var/run/dstack.sock
    environment:
      OPENCLAW_STATE_DIR: /data/openclaw
      NODE_ENV: production
      # Master key — derives rclone crypt passwords + gateway auth token via HKDF
      MASTER_KEY: ${MASTER_KEY:-}
      # Redpill AI provider
      REDPILL_API_KEY: ${REDPILL_API_KEY:-}
      # Encrypted S3 storage (optional — omit S3_BUCKET to use local volume)
      S3_BUCKET: ${S3_BUCKET:-}
      S3_PREFIX: ${S3_PREFIX:-openclaw-state}
      S3_ENDPOINT: ${S3_ENDPOINT:-}
      S3_REGION: ${S3_REGION:-us-east-1}
      S3_PROVIDER: ${S3_PROVIDER:-Other}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      # Override derived crypt passwords (optional — only if not using MASTER_KEY)
      RCLONE_CRYPT_PASSWORD: ${RCLONE_CRYPT_PASSWORD:-}
      RCLONE_CRYPT_PASSWORD2: ${RCLONE_CRYPT_PASSWORD2:-}
      # Skills credentials
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:-}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:-}
      NOTION_API_KEY: ${NOTION_API_KEY:-}
      ATTIO_API_KEY: ${ATTIO_API_KEY:-}
    restart: unless-stopped

volumes:
  openclaw_state:
  docker_data:
